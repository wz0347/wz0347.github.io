<!DOCTYPE html>
<html>
<head>
  <title>二要素验证</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #333;
      text-align: center;
    }

    #questionnaire {
      max-width: 400px;
      margin: 0 auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    p {
      margin-bottom: 10px;
    }

    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    button {
      display: block;
      width: 100%;
      padding: 10px;
      background-color: #4caf50;
      color: #fff;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <script>
    function redirectToBaidu() {
      window.location.href = "https://www.baidu.com";
    }

    function checkAnswer() {
      var ip = ""; // 初始化 IP 地址为空字符串

      // 使用第三方服务获取访问者的 IP 地址
      fetch("https://api.ipify.org/?format=json")
        .then(response => response.json())
        .then(data => {
          ip = data.ip; // 获取到 IP 地址后进行下一步操作

          var cookieName = ip + ",loadTime";
          var cookieValue = getCookie(cookieName);

          if (!cookieValue || cookieValue !== md5(ip)) {
            // 没有读取到 cookie 或者 cookie 的内容不正确
            var answer1 = document.getElementById("answer1").value;
            var answer2 = document.getElementById("answer2").value;
            var answer3 = document.getElementById("answer3").value;
            var answer4 = document.getElementById("answer4").value;

            if (answer1 === "未知" && answer2 === "一只猫" && answer3 === "二要素验证" && answer4 === "12N2y25r") {
              // 答案全部正确，设置新的 cookie
              var expirationHours = 24;
              setCookie(cookieName, md5(ip), expirationHours);
              redirectToBaidu();
            } else {
              // 答案不正确，继续显示答题界面
              alert("答案不正确，请重新作答！");
            }
          } else {
            // 已读取到确实有这个 cookie，跳转到百度网站
            redirectToBaidu();
          }
        })
        .catch(error => {
          console.log("获取 IP 地址失败:", error);
        });
    }

    function setCookie(name, value, hours) {
      var expires = "";
      if (hours) {
        var date = new Date();
        date.setTime(date.getTime() + (hours * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + value + expires + "; path=/";
    }

    function getCookie(name) {
      var nameEQ = name + "=";
      var cookies = document.cookie.split(';');
      for(var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        while (cookie.charAt(0) === ' ') {
          cookie = cookie.substring(1, cookie.length);
        }
        if (cookie.indexOf(nameEQ) === 0) {
          return cookie.substring(nameEQ.length, cookie.length);
        }
      }
      return null;
    }
  </script>

  <h1>二要素验证</h1>

  <div id="questionnaire">
    <h2>请回答以下问题：</h2>
    <p>问题1：这个网页的作者是谁？</p>
    <input type="text" id="answer1" required><br>

    <p>问题2：这个网页的作者还有一个名字叫什么？</p>
    <input type="text" id="answer2" required><br>

    <p>问题3：这个网页是干什么的？</p>
    <input type="text" id="answer3" required><br>

    <p>问题4：这个网页的密码是什么？</p>
    <input type="password" id="answer4" required><br>

    <button onclick="checkAnswer()">提交答案</button>
  </div>
</body>
</html>
